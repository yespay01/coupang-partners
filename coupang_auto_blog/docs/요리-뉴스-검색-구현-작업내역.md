# 요리/뉴스/검색 페이지 전체 구현 작업내역

> **작업일**: 2026-02-23
> **커밋**: `85a0ddf` (main)
> **변경 파일**: 25개 (+2,624줄)

---

## 개요

placeholder 상태였던 요리/뉴스/검색 페이지를 전면 구현했습니다.

| 기능 | 설명 |
|------|------|
| **요리 레시피** | 관리자가 요리명 입력 → AI 레시피 생성 → 쿠팡에서 재료 자동 검색 → 어필리에이트 링크 포함 |
| **뉴스** | 관리자가 주제/카테고리 입력 → AI 뉴스 기사 생성 |
| **검색** | 사용자가 키워드 입력 → 쿠팡 상품 실시간 검색 → 딥링크 자동 생성 |

---

## 1. DB 스키마 변경

**파일**: `automation-server/db/schema.sql`

### recipes 테이블
| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | SERIAL PK | |
| title | VARCHAR(500) | 요리 제목 |
| description | TEXT | 요리 소개 |
| ingredients | JSONB | 재료 목록 `[{name, amount, searchKeyword}]` |
| instructions | TEXT | 조리법 |
| coupang_products | JSONB | 쿠팡 검색 결과 `[{ingredientName, productName, productPrice, productImage, affiliateUrl}]` |
| image_url | TEXT | 대표 이미지 |
| slug | VARCHAR(255) UNIQUE | URL용 슬러그 |
| status | VARCHAR(50) | draft / published |
| view_count | INTEGER | 조회수 |
| created_at, updated_at | TIMESTAMP | |

### news 테이블
| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | SERIAL PK | |
| title | VARCHAR(500) | 기사 제목 |
| summary | TEXT | 요약 (2-3문장) |
| content | TEXT | 본문 |
| category | VARCHAR(255) | 카테고리 (트렌드/소비/테크/라이프/경제) |
| image_url | TEXT | 대표 이미지 |
| slug | VARCHAR(255) UNIQUE | URL용 슬러그 |
| status | VARCHAR(50) | draft / published |
| view_count | INTEGER | 조회수 |
| published_at | TIMESTAMP | 발행일 |
| created_at, updated_at | TIMESTAMP | |

---

## 2. 백엔드 라우트

### 신규 파일
| 파일 | 역할 |
|------|------|
| `automation-server/src/routes/recipe.js` | 공개 레시피 API (GET 목록/상세) |
| `automation-server/src/routes/news.js` | 공개 뉴스 API (GET 목록/상세) |
| `automation-server/src/routes/search.js` | 쿠팡 상품 검색 API (GET) |

### 수정 파일
| 파일 | 변경 내용 |
|------|----------|
| `automation-server/src/routes/admin.js` | 레시피/뉴스 CRUD + AI 생성 엔드포인트 추가 (+470줄) |
| `automation-server/src/index.js` | 3개 신규 라우트 등록 |

### API 엔드포인트 목록

**공개 API (인증 불필요)**
| 메서드 | 경로 | 설명 |
|--------|------|------|
| GET | `/api/recipes` | 레시피 목록 (published) |
| GET | `/api/recipes/id/:id` | 레시피 상세 + 조회수 증가 |
| GET | `/api/recipes/:slug` | 레시피 상세 (slug 기반) |
| GET | `/api/news` | 뉴스 목록 (published) |
| GET | `/api/news/id/:id` | 뉴스 상세 + 조회수 증가 |
| GET | `/api/news/:slug` | 뉴스 상세 (slug 기반) |
| GET | `/api/search?keyword=` | 쿠팡 상품 검색 + 딥링크 생성 |

**관리자 API (인증 필요)**
| 메서드 | 경로 | 설명 |
|--------|------|------|
| GET | `/api/admin/recipes` | 레시피 전체 목록 |
| GET | `/api/admin/recipes/:id` | 레시피 상세 |
| POST | `/api/admin/recipes/generate` | AI 레시피 생성 `{dishName}` |
| PUT | `/api/admin/recipes/:id` | 레시피 수정 |
| DELETE | `/api/admin/recipes/:id` | 레시피 삭제 |
| GET | `/api/admin/news` | 뉴스 전체 목록 |
| GET | `/api/admin/news/:id` | 뉴스 상세 |
| POST | `/api/admin/news/generate` | AI 뉴스 생성 `{topic, category}` |
| PUT | `/api/admin/news/:id` | 뉴스 수정 |
| DELETE | `/api/admin/news/:id` | 뉴스 삭제 |

---

## 3. 프론트엔드 API 프록시

**공개 프록시** (인증 없이 automation-server로 전달)
- `web/app/api/recipes/route.ts` — GET
- `web/app/api/recipes/[id]/route.ts` — GET
- `web/app/api/news/route.ts` — GET
- `web/app/api/news/[id]/route.ts` — GET
- `web/app/api/search/route.ts` — GET

**관리자 프록시** (admin_session 쿠키 인증 포함)
- `web/app/api/admin/recipes/route.ts` — GET
- `web/app/api/admin/recipes/[id]/route.ts` — GET/PUT/DELETE
- `web/app/api/admin/recipes/generate/route.ts` — POST
- `web/app/api/admin/news/route.ts` — GET
- `web/app/api/admin/news/[id]/route.ts` — GET/PUT/DELETE
- `web/app/api/admin/news/generate/route.ts` — POST

---

## 4. 관리자 페이지

### /admin/recipes — 레시피 관리
- 요리명 입력 → "AI 레시피 생성" 버튼
- AI가 레시피 JSON 생성 (제목, 설명, 재료, 조리법)
- 재료별로 쿠팡 상품 자동 검색 (최대 8개)
- 검색된 상품에 어필리에이트 딥링크 자동 생성
- 목록에서 발행/삭제 가능

### /admin/news — 뉴스 관리
- 카테고리 선택 (트렌드/소비/테크/라이프/경제) + 주제 입력
- "AI 뉴스 생성" 버튼 → AI가 기사 JSON 생성
- 목록에서 발행/삭제 가능

### DashboardNav 업데이트
- "요리", "뉴스" 네비게이션 링크 추가

---

## 5. 공개 페이지 (placeholder → 구현)

### /recipes — 레시피 목록
- 카드 그리드 (3열), 무한 스크롤 (더 보기)
- 재료 수, 날짜 표시

### /recipes/[id] — 레시피 상세
- 재료 목록 (이름 + 양)
- 쿠팡 재료 구매 카드 (이미지, 가격, 어필리에이트 링크)
- 조리법 단계별 표시
- 쿠팡 파트너스 고지 문구 포함
- ISR 적용 (1시간 revalidate)

### /news — 뉴스 목록
- 카드 그리드 (3열), 카테고리 뱃지
- 무한 스크롤

### /news/[id] — 뉴스 상세
- 카테고리 뱃지, 요약 박스, 본문
- ISR 적용 (1시간 revalidate)

### /search — 쿠팡 상품 검색
- 검색바 + 실시간 검색
- 상품 그리드 (4열): 이미지, 상품명, 가격
- 어필리에이트 딥링크 자동 적용
- 쿠팡 파트너스 고지 문구 포함

---

## 6. AI 생성 파이프라인

### 레시피 생성 흐름
```
관리자가 요리명 입력
  → AI에 JSON 형식 레시피 요청 (generateText)
  → JSON 파싱 (title, description, ingredients, instructions)
  → 재료별 쿠팡 상품 검색 (searchProducts, 최대 8개)
  → 검색 결과 URL로 딥링크 일괄 생성 (createDeeplinks)
  → DB 저장 (status: draft)
```

### 뉴스 생성 흐름
```
관리자가 주제 + 카테고리 입력
  → AI에 JSON 형식 기사 요청 (generateText)
  → JSON 파싱 (title, summary, content, category)
  → DB 저장 (status: draft)
```

---

## 7. 배포 방법

DB 마이그레이션 불필요 (`CREATE TABLE IF NOT EXISTS` + Docker 초기화 시 자동 생성)

```bash
git pull
docker-compose down
docker-compose build --no-cache
docker-compose up -d
```

---

## 8. 재사용한 기존 모듈

| 모듈 | 용도 |
|------|------|
| `aiProviders.js` → `generateText()` | AI 텍스트 생성 (레시피/뉴스) |
| `coupang/products.js` → `searchProducts()` | 쿠팡 상품 검색 (레시피 재료, 검색 페이지) |
| `coupang/deeplink.js` → `createDeeplinks()` | 어필리에이트 딥링크 생성 |
| `settingsService.js` → `getSystemSettings()` | AI/쿠팡 API 키 로드 |
| `SiteHeader`, `SiteFooter` | 공개 페이지 공통 레이아웃 |
| `apiClient` | 프론트엔드 API 호출 |
