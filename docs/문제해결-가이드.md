# ë¬¸ì œ í•´ê²° ê°€ì´ë“œ

> ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œì™€ í•´ê²° ë°©ë²•

---

## ğŸ” ë¹ ë¥¸ ì§„ë‹¨

### ì¦ìƒë³„ ë¶„ë¥˜

| ì¦ìƒ | ê°€ëŠ¥í•œ ì›ì¸ | ë°”ë¡œê°€ê¸° |
|------|------------|---------|
| í˜ì´ì§€ê°€ ì•ˆ ì—´ë¦¼ | ì»¨í…Œì´ë„ˆ ì¤‘ì§€, Nginx ë¬¸ì œ | [#1](#1-í˜ì´ì§€-ì ‘ì†-ë¶ˆê°€) |
| UIê°€ ê¹¨ì§ | CSS íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨ | [#2](#2-ui-ê¹¨ì§-ìŠ¤íƒ€ì¼-ì—†ìŒ) |
| ë¡œê·¸ì¸ ì•ˆë¨ | Firebase Auth, Admin SDK | [#3](#3-ê´€ë¦¬ì-ë¡œê·¸ì¸-ì‹¤íŒ¨) |
| ë¹Œë“œ ì‹¤íŒ¨ | ì˜ì¡´ì„±, ì„¤ì • ì˜¤ë¥˜ | [#4](#4-docker-ë¹Œë“œ-ì‹¤íŒ¨) |
| Functions ì—ëŸ¬ | API í‚¤, í™˜ê²½ë³€ìˆ˜ | [#5](#5-firebase-functions-ì—ëŸ¬) |

---

## 1. í˜ì´ì§€ ì ‘ì† ë¶ˆê°€

### ì¦ìƒ
```
https://semolink.store ì ‘ì† ì‹œ:
- "ì‚¬ì´íŠ¸ì— ì—°ê²°í•  ìˆ˜ ì—†ìŒ"
- "ì—°ê²° ì‹œê°„ ì´ˆê³¼"
- 502 Bad Gateway
```

### ì§„ë‹¨ ìˆœì„œ

#### 1-1. ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸

```bash
# ì„œë²„ì—ì„œ ì‹¤í–‰
docker ps | grep coupang-blog
```

**ì •ìƒ:**
```
coupang-blog ... Up X minutes ... 0.0.0.0:3000->3000/tcp
```

**ë¹„ì •ìƒ:**
```
# ì•„ë¬´ê²ƒë„ ì•ˆ ë‚˜ì˜´ â†’ ì»¨í…Œì´ë„ˆ ì¤‘ì§€ë¨
```

**í•´ê²°:**
```bash
# ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
docker start coupang-blog

# ë¡œê·¸ í™•ì¸
docker logs coupang-blog
```

---

#### 1-2. Next.js ì•± ì‘ë‹µ í™•ì¸

```bash
# ì„œë²„ì—ì„œ ì‹¤í–‰
curl http://127.0.0.1:3000
```

**ì •ìƒ:**
```html
<!DOCTYPE html><html lang="ko">...
```

**ë¹„ì •ìƒ:**
```
curl: (7) Failed to connect
```

**í•´ê²°:**
```bash
# ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
docker restart coupang-blog

# ê·¸ë˜ë„ ì•ˆë˜ë©´ ì¬ë°°í¬
docker stop coupang-blog && docker rm coupang-blog
# ... ë°°í¬ ëª…ë ¹ì–´
```

---

#### 1-3. Nginx ìƒíƒœ í™•ì¸

```bash
# ì„œë²„ì—ì„œ ì‹¤í–‰
sudo systemctl status nginx
```

**ì •ìƒ:**
```
Active: active (running)
```

**ë¹„ì •ìƒ:**
```
Active: inactive (dead)
```

**í•´ê²°:**
```bash
sudo systemctl start nginx

# ì„¤ì • ì—ëŸ¬ ì‹œ
sudo nginx -t
sudo systemctl restart nginx
```

---

## 2. UI ê¹¨ì§ (ìŠ¤íƒ€ì¼ ì—†ìŒ)

### ì¦ìƒ
- í˜ì´ì§€ëŠ” ì—´ë¦¬ì§€ë§Œ ìŠ¤íƒ€ì¼ ì—†ìŒ
- í…ìŠ¤íŠ¸ë§Œ ë‚˜ì—´ë¨
- ë¸Œë¼ìš°ì € ì½˜ì†”: "404 (Not Found) _next/static/css/..."

### ì›ì¸
CSS íŒŒì¼ì´ ë¡œë“œë˜ì§€ ì•ŠìŒ

### ì§„ë‹¨

```bash
# ì„œë²„ì—ì„œ ì‹¤í–‰
docker exec coupang-blog ls -la /app/.next/static/css/
```

**ì •ìƒ:**
```
-rw-r--r-- ... 0a69a2b5a3c3065a.css
```

**ë¹„ì •ìƒ:**
```
ls: cannot access '/app/.next/static/css/': No such file or directory
```

### í•´ê²°

#### ë°©ë²• 1: ì¬ë¹Œë“œ

```bash
cd /home/insuk/blog
docker stop coupang-blog && docker rm coupang-blog
docker build --no-cache -t blog-coupang-blog .
docker run -d --name coupang-blog --restart always -p 3000:3000 --env-file .env.production blog-coupang-blog
```

#### ë°©ë²• 2: Dockerfile í™•ì¸

```dockerfile
# ì˜¬ë°”ë¥¸ Dockerfile
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static
```

---

## 3. ê´€ë¦¬ì ë¡œê·¸ì¸ ì‹¤íŒ¨

### ì¦ìƒ
- "idTokenì´ í•„ìš”í•©ë‹ˆë‹¤" (HTTP 400)
- "Firebase ì´ˆê¸°í™” ì‹¤íŒ¨"
- "ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ"

### 3-1. idTokenì´ í•„ìš”í•©ë‹ˆë‹¤

**ì›ì¸:**
- Firebase Admin SDK í‚¤ ì—†ìŒ

**ì§„ë‹¨:**
```bash
docker exec coupang-blog env | grep FIREBASE_ADMIN_PRIVATE_KEY
```

**í•´ê²°:**
```bash
# ì„œë²„ì—ì„œ .env.production í™•ì¸
cat /home/insuk/blog/.env.production | grep FIREBASE_ADMIN

# ì—†ìœ¼ë©´ ì¶”ê°€ í›„ ì¬ì‹œì‘
docker stop coupang-blog && docker rm coupang-blog
# ... ì¬ë°°í¬
```

---

### 3-2. Firebase ì´ˆê¸°í™” ì‹¤íŒ¨

**ì›ì¸:**
- NEXT_PUBLIC_FIREBASE_* í™˜ê²½ë³€ìˆ˜ ì—†ìŒ

**ì§„ë‹¨:**
```bash
docker exec coupang-blog env | grep NEXT_PUBLIC_FIREBASE_PROJECT_ID
```

**í•´ê²°:**
```bash
# í™˜ê²½ë³€ìˆ˜ íŒŒì¼ í™•ì¸
cat /home/insuk/blog/.env.production

# --env-file ì˜µì…˜ í™•ì¸ í›„ ì¬ë°°í¬
docker run -d --name coupang-blog --restart always -p 3000:3000 \
  --env-file .env.production \
  blog-coupang-blog
```

---

### 3-3. ë°”ì´íŒ¨ìŠ¤ ë¡œê·¸ì¸ ì•ˆë¨

**ì›ì¸:**
- NODE_ENV=productionì´ë¼ bypass ë¶ˆê°€

**í•´ê²° (ì„ì‹œ):**
```bash
# .env.production ìˆ˜ì •
nano /home/insuk/blog/.env.production

# ë³€ê²½
NODE_ENV=development
ADMIN_GUARD_BYPASS=true

# ì¬ë°°í¬
```

**ì£¼ì˜:** í”„ë¡œë•ì…˜ì—ì„œëŠ” ë³´ì•ˆ ìœ„í—˜!

---

## 4. Docker ë¹Œë“œ ì‹¤íŒ¨

### 4-1. "Cannot find module"

**ì¦ìƒ:**
```
Error: Cannot find module 'xxx'
```

**ì›ì¸:**
- package.jsonì— ì˜ì¡´ì„± ì—†ìŒ

**í•´ê²°:**
```bash
# ë¡œì»¬ì—ì„œ
cd web
npm install xxx --save

# package.json, package-lock.json ì„œë²„ë¡œ ì „ì†¡
scp package.json package-lock.json insuk@192.168.0.5:/home/insuk/blog/

# ì¬ë¹Œë“œ
```

---

### 4-2. "npm ci ì‹¤íŒ¨"

**ì¦ìƒ:**
```
npm ci exited with code 1
```

**ì›ì¸:**
- package-lock.json ì¶©ëŒ

**í•´ê²°:**
```bash
# ë¡œì»¬ì—ì„œ ì¬ìƒì„±
cd web
rm -rf node_modules package-lock.json
npm install

# ì„œë²„ë¡œ ì „ì†¡
scp package-lock.json insuk@192.168.0.5:/home/insuk/blog/

# ì¬ë¹Œë“œ
```

---

### 4-3. "server.js not found"

**ì¦ìƒ:**
```
Error: Cannot find module '/app/server.js'
```

**ì›ì¸:**
- next.config.tsì— outputFileTracingRoot ìˆìŒ

**í•´ê²°:**
```typescript
// next.config.ts
const nextConfig: NextConfig = {
  output: "standalone",
  // outputFileTracingRoot ì œê±°!
};
```

---

## 5. Firebase Functions ì—ëŸ¬

### 5-1. Coupang API ì‹¤íŒ¨

**ì¦ìƒ:**
```
Error: Coupang API ì¸ì¦ ì‹¤íŒ¨
```

**ì›ì¸:**
- Functions í™˜ê²½ë³€ìˆ˜ ì—†ìŒ

**ì§„ë‹¨:**
```bash
firebase functions:config:get
```

**í•´ê²°:**
```bash
firebase functions:config:set \
  coupang.access_key="..." \
  coupang.secret_key="..."

firebase deploy --only functions
```

---

### 5-2. AI API ì‹¤íŒ¨

**ì¦ìƒ:**
```
Error: OpenAI API key not found
```

**í•´ê²°:**
```bash
firebase functions:config:set \
  openai.api_key="sk-..." \
  gemini.api_key="..."

firebase deploy --only functions
```

---

## 6. ì„±ëŠ¥ ë¬¸ì œ

### 6-1. í˜ì´ì§€ ë¡œë”© ëŠë¦¼

**ì§„ë‹¨:**
```bash
# ì„œë²„ ë©”ëª¨ë¦¬ í™•ì¸
docker stats coupang-blog

# ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
docker restart coupang-blog
```

---

### 6-2. ë””ìŠ¤í¬ ê°€ë“ ì°¸

**ì¦ìƒ:**
```
no space left on device
```

**ì§„ë‹¨:**
```bash
df -h
docker system df
```

**í•´ê²°:**
```bash
# Docker ì´ë¯¸ì§€ ì •ë¦¬
docker system prune -a

# ì˜¤ë˜ëœ ë¡œê·¸ ì‚­ì œ
docker logs coupang-blog --tail 100
```

---

## 7. Nginx ë¬¸ì œ

### 7-1. 502 Bad Gateway

**ì›ì¸:**
- Next.js ì•± ì‘ë‹µ ì—†ìŒ

**í•´ê²°:**
```bash
# Next.js ì•± í™•ì¸
curl http://127.0.0.1:3000

# ì•ˆë˜ë©´ ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
docker restart coupang-blog
```

---

### 7-2. SSL ì¸ì¦ì„œ ë§Œë£Œ

**ì¦ìƒ:**
```
NET::ERR_CERT_DATE_INVALID
```

**í•´ê²°:**
```bash
# ì¸ì¦ì„œ ê°±ì‹ 
sudo certbot renew

# Nginx ì¬ì‹œì‘
sudo systemctl reload nginx
```

---

## 8. ê°œë°œ í™˜ê²½ ë¬¸ì œ

### 8-1. npm run dev ì‹¤íŒ¨

**ì›ì¸:**
- í¬íŠ¸ 3000 ì‚¬ìš© ì¤‘

**í•´ê²°:**
```bash
# Windows
netstat -ano | findstr :3000
taskkill /PID [PID] /F

# ë˜ëŠ” ë‹¤ë¥¸ í¬íŠ¸ ì‚¬ìš©
npm run dev -- -p 3001
```

---

### 8-2. TypeScript ì—ëŸ¬

**ì¦ìƒ:**
```
Type 'xxx' is not assignable to type 'yyy'
```

**í•´ê²°:**
```bash
# íƒ€ì… ì •ì˜ ì¬ì„¤ì¹˜
npm install --save-dev @types/node @types/react

# ìºì‹œ ì‚­ì œ
rm -rf .next node_modules
npm install
```

---

## ğŸ”§ ì¼ë°˜ì ì¸ í•´ê²° ìˆœì„œ

### 1ë‹¨ê³„: ì¬ì‹œì‘

```bash
# ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
docker restart coupang-blog

# Nginx ì¬ì‹œì‘
sudo systemctl restart nginx
```

### 2ë‹¨ê³„: ë¡œê·¸ í™•ì¸

```bash
# Docker ë¡œê·¸
docker logs coupang-blog --tail 100

# Nginx ë¡œê·¸
sudo tail -f /var/log/nginx/semolink-blog-error.log
```

### 3ë‹¨ê³„: ì¬ë¹Œë“œ

```bash
# ì™„ì „ ì¬ë¹Œë“œ
docker stop coupang-blog && docker rm coupang-blog
docker build --no-cache -t blog-coupang-blog .
docker run -d --name coupang-blog --restart always -p 3000:3000 --env-file .env.production blog-coupang-blog
```

---

## ğŸ†˜ ê¸´ê¸‰ ë³µêµ¬

### ì„œë¹„ìŠ¤ ì „ì²´ ë‹¤ìš´

```bash
# 1. ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
docker ps -a

# 2. ëª¨ë‘ ì¬ì‹œì‘
docker restart coupang-blog
sudo systemctl restart nginx

# 3. í™•ì¸
curl https://semolink.store
```

---

### ë°ì´í„° ì†ì‹¤ ìœ„í—˜

```bash
# Firestore ë°±ì—…
firebase firestore:export gs://blog-automation-23092.appspot.com/backup

# ì½”ë“œ ë°±ì—… (ì„œë²„)
cd /home/insuk/blog
tar -czf ~/blog-backup-$(date +%Y%m%d).tar.gz .
```

---

## ğŸ“ ë„ì›€ ìš”ì²­ ì‹œ ì œê³µí•  ì •ë³´

```
1. ì¦ìƒ ìƒì„¸ ì„¤ëª…
   - ì–¸ì œ ë°œìƒí–ˆë‚˜ìš”?
   - ì–´ë–¤ ì‘ì—… í›„ ë°œìƒí–ˆë‚˜ìš”?
   - ì¬í˜„ ê°€ëŠ¥í•œê°€ìš”?

2. ì—ëŸ¬ ë©”ì‹œì§€
   - ë¸Œë¼ìš°ì € ì½˜ì†” ì—ëŸ¬
   - Docker ë¡œê·¸
   - Nginx ë¡œê·¸

3. ì‹œë„í•œ í•´ê²°ì±…
   - ì¬ì‹œì‘ í–ˆë‚˜ìš”?
   - ì¬ë¹Œë“œ í–ˆë‚˜ìš”?
   - ì„¤ì • ë³€ê²½í–ˆë‚˜ìš”?

4. í™˜ê²½ ì •ë³´
   - ë¡œì»¬ / ì„œë²„
   - ë¸Œë¼ìš°ì € ì¢…ë¥˜ ë° ë²„ì „
   - ìµœê·¼ ë³€ê²½ì‚¬í•­
```

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸:** 2026-02-03
