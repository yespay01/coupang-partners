(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[852],{63:(e,t,s)=>{"use strict";var a=s(7260);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},2498:(e,t,s)=>{"use strict";s.d(t,{D:()=>u,R:()=>o});var a=s(5155),r=s(2115),l=s(3885),n=s(8789);let i=(0,r.createContext)(void 0);function o(e){let{children:t}=e,s=function(){let[e,t]=(0,r.useState)({status:"initializing",user:null,error:null});return(0,r.useEffect)(()=>{let e,s=!0;return async function(){try{let{app:a}=await (0,n.w)(),r=(0,l.xI)(a);e=(0,l.hg)(r,e=>{s&&t({status:"ready",user:e,error:null})})}catch(e){if(!s)return;t({status:"error",user:null,error:e instanceof Error?e:Error("Firebase 초기화 실패")})}}(),()=>{s=!1,e&&e()}},[]),e}(),o=(0,r.useMemo)(()=>s,[s]);return(0,a.jsx)(i.Provider,{value:o,children:t})}function u(){let e=(0,r.useContext)(i);if(!e)throw Error("useFirebase는 FirebaseProvider 내부에서만 사용할 수 있습니다.");return e}},3553:(e,t,s)=>{Promise.resolve().then(s.bind(s,9276))},8789:(e,t,s)=>{"use strict";s.d(t,{w:()=>n});var a=s(2078),r=s(8871);let l=null;async function n(){if(l)return l;let e=(0,a.Dk)().length?(0,a.Dk)()[0]:(0,a.Wp)(function(){return{apiKey:"AIzaSyCPI1msAqKlbF83upcdEClY9xlAMhJs-3I",authDomain:"blog-automation-23092.firebaseapp.com",projectId:"blog-automation-23092",storageBucket:"blog-automation-23092.firebasestorage.app",messagingSenderId:"944342575434",appId:"1:944342575434:web:f9ee17d38296ffe0aaf9b3",measurementId:""}}()),t=null;return t=await (0,r.TT)()?(0,r.P5)(e):null,l={app:e,analytics:t}}},9276:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var a=s(5155),r=s(2115),l=s(2619),n=s.n(l),i=s(63),o=s(3885),u=s(2498);let d={email:"",password:""};function c(){var e;let{status:t,user:s,error:l}=(0,u.D)(),c=(0,i.useSearchParams)(),x=(0,i.useRouter)(),m=null!=(e=c.get("redirect"))?e:"/admin",[b,p]=(0,r.useState)("Firebase Auth를 통해 관리자 로그인이 필요합니다."),[h,f]=(0,r.useState)(d),[y,g]=(0,r.useState)(!1),[j,w]=(0,r.useState)(null),[N,v]=(0,r.useState)(null),[k,S]=(0,r.useState)(null);(0,r.useEffect)(()=>{"ready"===t&&s?p("이미 로그인되어 있습니다. 대시보드로 이동하거나 세션을 갱신하세요."):"error"===t?p("Firebase 초기화에 실패했습니다. 환경변수를 확인하세요."):p("Firebase Auth를 통해 관리자 로그인이 필요합니다.")},[t,s]),(0,r.useEffect)(()=>{if("ready"===t&&s&&N){let e=setTimeout(()=>{x.replace(m)},1200);return()=>clearTimeout(e)}},[t,s,N,x,m]);let C=(0,r.useCallback)(e=>t=>{f(s=>({...s,[e]:t.target.value}))},[]),P=(0,r.useCallback)(async e=>{let t,s={};try{t=await fetch("/api/admin/session",{credentials:"same-origin",...e})}catch(t){let e=t instanceof Error?t.message:"네트워크 오류로 요청에 실패했습니다.";throw S({status:0,message:e}),Error(e)}try{s=await t.json()}catch(e){s={}}let a="string"==typeof s.message?s.message:t.ok?"세션이 정상적으로 처리되었습니다.":"세션 요청 실패 (HTTP ".concat(t.status,")");if(S({status:t.status,message:a}),!t.ok)throw Error(a);return s},[]),E=(0,r.useCallback)(async e=>{if(e.preventDefault(),w(null),v(null),"error"===t)return void w("Firebase가 준비되지 않았습니다. 관리자에게 문의하세요.");g(!0);try{let e=(0,o.xI)(),t=await (0,o.x9)(e,h.email,h.password),s=await t.user.getIdToken(!0);await P({method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({idToken:s})}),v("관리자 세션이 발급되었습니다. 잠시 후 대시보드로 이동합니다."),f(d)}catch(e){w(e instanceof Error?e.message:"로그인 중 오류가 발생했습니다.")}finally{g(!1)}},[h.email,h.password,P,t]),I=(0,r.useCallback)(async()=>{w(null),v(null),g(!0);try{await P({method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bypass:!0})}),v("바이패스 세션이 발급되었습니다. 잠시 후 이동합니다.")}catch(e){w(e instanceof Error?e.message:"바이패스 세션 중 오류가 발생했습니다.")}finally{g(!1)}},[P]),A=(0,r.useCallback)(async()=>{w(null),v(null),g(!0);try{let e=(0,o.xI)();await (0,o.CI)(e),await P({method:"DELETE"}),v("로그아웃되었습니다.")}catch(e){w(e instanceof Error?e.message:"로그아웃 중 오류가 발생했습니다.")}finally{g(!1)}},[P]);return(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-slate-950 px-6",children:(0,a.jsxs)("div",{className:"w-full max-w-md rounded-3xl border border-white/10 bg-slate-900/80 p-8 text-slate-100 shadow-2xl backdrop-blur",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-white",children:"관리자 로그인"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-slate-300",children:b}),l?(0,a.jsx)("p",{className:"mt-2 rounded-xl border border-rose-200 bg-rose-50 px-4 py-2 text-xs text-rose-600",children:l.message}):null,(0,a.jsxs)("form",{className:"mt-6 space-y-4 text-sm",onSubmit:E,children:[(0,a.jsxs)("label",{className:"block text-slate-200",children:[(0,a.jsx)("span",{className:"text-xs uppercase tracking-wide text-slate-400",children:"이메일"}),(0,a.jsx)("input",{type:"email",required:!0,value:h.email,onChange:C("email"),className:"mt-2 w-full rounded-xl border border-slate-700 bg-slate-900 px-3 py-2 text-slate-100 focus:border-slate-500 focus:outline-none focus:ring-2 focus:ring-slate-500/40",placeholder:"admin@example.com",autoComplete:"email"})]}),(0,a.jsxs)("label",{className:"block text-slate-200",children:[(0,a.jsx)("span",{className:"text-xs uppercase tracking-wide text-slate-400",children:"비밀번호"}),(0,a.jsx)("input",{type:"password",required:!0,value:h.password,onChange:C("password"),className:"mt-2 w-full rounded-xl border border-slate-700 bg-slate-900 px-3 py-2 text-slate-100 focus:border-slate-500 focus:outline-none focus:ring-2 focus:ring-slate-500/40",placeholder:"********",autoComplete:"current-password"})]}),(0,a.jsx)("button",{type:"submit",className:"w-full rounded-full bg-white px-4 py-2 text-sm font-semibold text-slate-900 transition hover:bg-slate-100 disabled:cursor-not-allowed disabled:opacity-70",disabled:y||"ready"!==t,children:y?"로그인 처리 중...":"로그인"})]}),(0,a.jsxs)("div",{className:"mt-4 flex flex-col gap-2 text-xs text-slate-300",children:[(0,a.jsx)("button",{type:"button",onClick:I,className:"rounded-full border border-slate-700 px-4 py-2 font-semibold text-slate-200 transition hover:bg-slate-800 disabled:cursor-not-allowed disabled:opacity-70",disabled:y,children:"로컬 개발용 세션 발급 (ADMIN_GUARD_BYPASS)"}),s?(0,a.jsx)("button",{type:"button",onClick:A,className:"rounded-full border border-rose-200 px-4 py-2 font-semibold text-rose-300 transition hover:bg-rose-500/20 disabled:cursor-not-allowed disabled:opacity-70",disabled:y,children:"Firebase 로그아웃"}):null]}),j?(0,a.jsx)("p",{className:"mt-4 rounded-xl border border-rose-200 bg-rose-50 px-4 py-2 text-xs text-rose-600",children:j}):null,N?(0,a.jsx)("p",{className:"mt-4 rounded-xl border border-emerald-200 bg-emerald-50 px-4 py-2 text-xs text-emerald-600",children:N}):null,k?(0,a.jsxs)("div",{className:"mt-6 rounded-2xl border border-slate-700 bg-slate-800/70 px-4 py-4 text-xs text-slate-300",children:[(0,a.jsx)("p",{className:"font-semibold text-slate-100",children:"세션 요청 상태"}),(0,a.jsxs)("p",{className:"mt-1",children:["최근 응답:"," ",k.status>0?"HTTP ".concat(k.status):"네트워크 오류 또는 응답 없음"]}),(0,a.jsx)("p",{className:"mt-1 text-slate-200",children:k.message}),400===k.status?(0,a.jsxs)("ul",{className:"mt-3 list-disc space-y-1 pl-4 text-[11px] text-slate-400",children:[(0,a.jsx)("li",{children:"Firebase Auth 계정이 생성되었고 이메일/비밀번호가 올바른지 확인하세요."}),(0,a.jsx)("li",{children:"Custom Claim `admin=true` 설정 여부 및 `npm run set-admin -- --email you@example.com` 실행 이력을 확인하세요."}),(0,a.jsx)("li",{children:"로컬 개발이라면 `.env.local`에 `ADMIN_GUARD_BYPASS=true`를 선언한 뒤 서버를 재시작하세요."})]}):null,403===k.status?(0,a.jsx)("p",{className:"mt-3 text-[11px] text-amber-300",children:"관리자 권한이 없는 계정입니다. Firebase Functions 폴더에서 `npm run set-admin` 명령으로 커스텀 클레임을 부여한 뒤 다시 로그인하세요."}):null]}):null,(0,a.jsxs)("div",{className:"mt-6 rounded-2xl border border-slate-700 bg-slate-800/70 px-4 py-4 text-xs text-slate-300",children:[(0,a.jsx)("p",{className:"font-semibold text-slate-200",children:"운영 체크리스트"}),(0,a.jsxs)("ul",{className:"mt-2 list-disc space-y-1 pl-4",children:[(0,a.jsx)("li",{children:"Firebase Authentication에서 허용된 관리자 계정을 등록합니다."}),(0,a.jsx)("li",{children:"ID 토큰에 custom claim `admin=true` 를 설정해야 합니다."}),(0,a.jsx)("li",{children:"Prod 환경에서는 `.env`에 Admin SDK 키를 반드시 설정하세요."})]})]}),(0,a.jsxs)("div",{className:"mt-8 flex flex-col gap-3 text-sm",children:[(0,a.jsx)(n(),{href:m,className:"inline-flex w-full items-center justify-center rounded-full bg-slate-100 px-4 py-2 font-semibold text-slate-900 transition hover:bg-white",children:"대시보드로 이동"}),(0,a.jsx)(n(),{href:"/",className:"inline-flex w-full items-center justify-center rounded-full border border-slate-700 px-4 py-2 font-semibold text-slate-200 transition hover:bg-slate-800",children:"메인으로 돌아가기"})]})]})})}function x(){return(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-slate-950 px-6",children:(0,a.jsxs)("div",{className:"w-full max-w-md rounded-3xl border border-white/10 bg-slate-900/80 p-8 text-slate-100 shadow-2xl backdrop-blur",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-white",children:"관리자 로그인"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-slate-300",children:"로딩 중..."})]})})}function m(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)(x,{}),children:(0,a.jsx)(c,{})})}}},e=>{e.O(0,[811,200,182,619,441,255,358],()=>e(e.s=3553)),_N_E=e.O()}]);