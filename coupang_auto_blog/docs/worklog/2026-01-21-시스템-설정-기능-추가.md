# 2026-01-21 시스템 설정 기능 추가

## 작업 개요

관리자 대시보드에 시스템 설정 페이지를 추가하여 자동 수집, AI 모델 선택, 프롬프트 편집, 쿠팡 API 연동 기능을 구현했습니다.

## 구현 내용

### Phase 1: 기본 인프라

#### 타입 정의 (web/types/settings.ts)
- `SystemSettings`: 전체 설정 스키마
- `AIProvider`, `AISettings`: AI 제공자 설정
- `AutomationSettings`, `TopicSettings`, `PromptSettings`, `CoupangAPISettings`
- 기본값 상수 (`DEFAULT_SETTINGS`)

#### Firestore 서비스 (web/lib/settingsService.ts)
- `getSystemSettings()`: 설정 조회
- `updateSystemSettings()`: 설정 업데이트 (중첩 객체 지원)
- `subscribeToSettings()`: 실시간 구독
- 기본값과 저장된 값 병합 로직

#### Zustand 스토어 (web/stores/settingsStore.ts)
- UI 상태 관리 (activeTab, hasUnsavedChanges 등)
- 각 설정 항목별 setter 함수

#### React Query 훅 (web/hooks/useSystemSettings.ts)
- `useSystemSettings()`: 설정 조회/저장
- `useSettingsValidation()`: 설정 유효성 검증
- `useCoupangConnectionTest()`: 쿠팡 연결 테스트

### Phase 2: 설정 페이지 UI

#### 설정 페이지 라우트
- `web/app/(dashboard)/admin/settings/page.tsx`

#### 설정 컴포넌트 (web/components/admin/settings/)
- `SettingsView.tsx`: 탭 네비게이션, 저장/되돌리기 버튼
- `AutomationSettings.tsx`: 자동 수집 ON/OFF, 스케줄, 최대 수집 수
- `TopicSettings.tsx`: 카테고리 토글, 키워드 태그 입력
- `AISettings.tsx`: OpenAI/Claude/Gemini 설정, 모델 선택
- `PromptSettings.tsx`: 시스템 프롬프트, 리뷰 템플릿, 글자 수 제한
- `CoupangSettings.tsx`: API 키 입력, 연결 테스트

#### 네비게이션 추가
- `web/app/(dashboard)/layout.tsx`에 "설정" 메뉴 추가

### Phase 3: 쿠팡 API 연동

#### 쿠팡 API 클라이언트 (functions/src/coupangApi.js)
- HMAC-SHA256 서명 생성
- `searchProducts()`: 상품 검색
- `getBestProducts()`: 카테고리별 베스트 상품
- `createDeeplinks()`: 딥링크 생성
- `recommendCategory()`: 카테고리 추천

#### 상품 수집 스케줄러 (functions/src/collectProducts.js)
- 매일 설정된 시간에 자동 실행
- 키워드/카테고리 기반 수집
- 딥링크 자동 생성

#### 연결 테스트 API
- `web/app/api/settings/coupang/test/route.ts`

### Phase 4: 다중 AI 지원

#### AI 제공자 클라이언트 (functions/src/aiProviders.js)
- OpenAI: `generateWithOpenAI()`
- Anthropic: `generateWithAnthropic()`
- Google: `generateWithGoogle()`
- 통합 함수: `generateText()`

#### generateReview.js 수정
- Firestore에서 설정 로드
- 다중 AI 제공자 지원
- 설정 기반 프롬프트 및 검증

#### reviewUtils.js 확장
- `buildPromptFromSettings()`: 설정 기반 프롬프트 생성
- `validateReviewContentWithSettings()`: 설정 기반 검증

### Phase 5: 문서화

- `docs/architecture/settings-feature.md`: 설정 기능 설계 문서
- `docs/architecture/project-structure.md`: 프로젝트 구조 문서
- `docs/worklog/2026-01-21-시스템-설정-기능-추가.md`: 작업 로그

## 생성된 파일 목록

### 웹 프론트엔드
- `web/types/settings.ts`
- `web/lib/settingsService.ts`
- `web/stores/settingsStore.ts`
- `web/hooks/useSystemSettings.ts`
- `web/app/(dashboard)/admin/settings/page.tsx`
- `web/app/api/settings/route.ts`
- `web/app/api/settings/coupang/test/route.ts`
- `web/components/admin/settings/SettingsView.tsx`
- `web/components/admin/settings/AutomationSettings.tsx`
- `web/components/admin/settings/TopicSettings.tsx`
- `web/components/admin/settings/AISettings.tsx`
- `web/components/admin/settings/PromptSettings.tsx`
- `web/components/admin/settings/CoupangSettings.tsx`
- `web/components/admin/settings/index.ts`

### Firebase Functions
- `functions/src/aiProviders.js`
- `functions/src/coupangApi.js`
- `functions/src/collectProducts.js`

### 수정된 파일
- `web/app/(dashboard)/layout.tsx` - 설정 메뉴 추가
- `functions/src/generateReview.js` - 설정 기반 리뷰 생성
- `functions/src/reviewUtils.js` - 설정 기반 함수 추가
- `functions/src/index.js` - 새 함수 export
- `functions/package.json` - AI SDK 의존성 추가

## 의존성 추가 (functions/package.json)
- `@anthropic-ai/sdk`: Anthropic Claude API
- `@google/generative-ai`: Google Gemini API
- `openai`: OpenAI API

## 다음 단계

1. Firestore 보안 규칙 업데이트 (system_settings 컬렉션)
2. 프로덕션 배포 테스트
3. API 키 암호화 저장 검토
4. 에러 핸들링 강화
